### kafka 同样支持发布订阅的方式发送消息 我们来编写一下案例

1. 压缩
  
  引入 CompressionTypes 选择压缩模式 GIZP LZ4 zSTD

```js
import { Kafka, CompressionTypes } from "kafkajs";

await producer.send({
  topic: "xiaoman",
  compression: CompressionTypes.GZIP,
  messages: [
    {
      value: "测试数据1",
      headers: {
        name: Buffer.from("小满"),
      },
    },
    { value: Buffer.from("测试数据2") },
  ],
});
```

2. 标头
  
  允许使用标头传递对象元数据，把需要传递的数据放在 headers 即可将数据一起被发送过去

```js
await producer.send({
  topic: "xiaoman",
  messages: [
    {
      value: "测试数据1",
      headers: {
        name: Buffer.from("小满"),
      },
    },
    { value: Buffer.from("测试数据2") },
  ],
});
```

消费者获取 headers 元数据

```js
await consumer.run({
  eachMessage: async ({ topic, partition, message }) => {
    console.log({
      topic,
      partition,
      value: message.value.toString(),
      headers: message.headers?.name?.toString(),
    });
  },
});
```

3. 多主题派发

```js

send 发方法换成 sendBatch 增加 topicMessages 是个数组

await producer.sendBatch({
  topicMessages: [
    {
      topic: "xiaoman",
      messages: [{ value: Buffer.from("测试数据1") }],
    },
    {
      topic: "xiaoman2",
      messages: [{ value: Buffer.from("测试数据2") }],
    },
  ],
});
```
